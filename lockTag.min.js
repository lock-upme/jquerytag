(function($){$.fn.lockTag=function(options){var defaults={tag:null,limit:10};var opts=$.extend(defaults,options);var obj=$(this);var add=function(e){obj.delegate("input","keypress",function(e){var that=$(this);that.next().hide();if(e.keyCode==13){if(that.val()==""){return false}if(obj.find(".ui-tag").length==opts.limit){that.val("");return false}that.css("width","60px").parent().before('<span class="ui-tag">#'+that.val()+"</span>");that.val("")}})};var inputFocus=function(){obj.delegate(".ui-iptwrap","click",function(){obj.find("input").focus()})};var tipsShow=function(){obj.delegate("input","blur",function(){var that=$(this);if(obj.find(".ui-tag").length==0){that.next().show()}})};var removeBackspace=function(){obj.delegate("input","keydown",function(e){if(e.keyCode==8){var that=$(this);if($.trim(that.val())==""){that.parent().prev().remove()}}})};var removeMouse=function(){obj.delegate(".ui-tag","click",function(e){$(this).remove();if(obj.find(".ui-tag").length==0){obj.find("label").show()}})};var init=function(){var html="";html+='<div class="ui-tags">';html+='<div class="ui-iptwrap">';html+='<input maxlength="20" /><label>添加相关标签，用回车分隔、退格/点击删除</label>';html+="</div>";html+="</div>";obj.html(html);if(opts.tag){obj.find("input").css("width","60px");var tagarr=opts.tag.split(",");$.each(tagarr,function(i,tag){obj.find(".ui-tags").prepend('<span class="ui-tag">#'+tag+"</span>")});obj.find("label").hide()}add();tipsShow();inputFocus();removeMouse();removeBackspace()};init()}})(jQuery);